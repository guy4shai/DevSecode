<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&family=Queens&display=swap" rel="stylesheet">
  <title>Alert Detail</title>
  <style>
    body {
      font-family: 'Lexend Deca', sans-serif;
      padding: 20px;
      background-color: #1e1e1e;
      color: black;
    }

    h1 {
      font-size: 24px;
      color: rgb(224, 223, 223);
      margin-bottom: 20px;
      font-weight: 550;
    }

    .alert-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .alert {
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      font-size: 16.3px;
    }

    .details p {
      margin: 8px 0;
      font-size: 16.3px;
    }

    .details strong {
      color: #000000;
      font-family: 'Lexend Deca', sans-serif;
      font-size: 16.3px;
    }

    .alert.critical {
      background-color: #B33A3A;
      color: #fff;
    }
    .alert.high {
      background-color: #FF6F61;
      color: #fff;
    }
    .alert.medium {
      background-color: #FFB347;
      color: #000;
    }
    .alert.low {
      background-color: #FFF176;
      color: #000;
    }

    .go-to-line-btn {
      background-color: #afaeae; /* Light grey background */
      color: #000000;            /* Black text */
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
      font-family: 'Lexend Deca', sans-serif; /* Ensures the font */
    }

    .go-to-line-btn:hover {
      background-color: #cfcece; /* Slightly darker grey on hover */
    }

  </style>
</head>
<body>

  <h1 id="alertTitle">
    Alert:
  </h1>

  <div id="alertsContainer"></div>

  <!-- Button to go to the line in code -->
  <button id="goToLineButton" class="go-to-line-btn">Go to Line</button>

  <script>
  const vscode = acquireVsCodeApi();
  const alertsContainer = document.getElementById("alertsContainer");

  const severityColors = {
    Critical: "#B33A3A",
    High: "#FF6F61",
    Medium: "#FFB347",
    Low: "#FFF176"
  };

  // Function to calculate severity based on entropy
  function getSeverityByEntropy(entropy) {
    if (entropy > 4.5) return "Critical";
    if (entropy > 4) return "High";
    if (entropy > 3.5) return "Medium";
    return "Low";
  }

  // Assume `reportData` is an array with alert objects
  const match = reportData.find(item =>
    item.RuleID === targetRuleID && item.StartLine === targetStartLine
  );

  if (!match) {
    alertsContainer.innerHTML = "<p style='color: white;'>No matching alert found.</p>";
  } else {
    // Calculate severity based on entropy
    const entropy = match.Entropy; // Assuming `Entropy` is available in match
    const severity = getSeverityByEntropy(entropy);  // Get severity based on entropy
    const color = severityColors[severity] || "#c5c5c5";

    const alert = document.createElement("div");
    alert.classList.add("alert", severity.toLowerCase()); // Add the correct class for styling

    alert.innerHTML = `
      <div class="details">
        <p><strong>Description:</strong> ${match.Description || "N/A"}</p>
        <p><strong>Line:</strong> ${match.StartLine}</p>
        <p><strong>Severity:</strong> ${severity}</p>
      </div>
    `;
    alertsContainer.appendChild(alert);

    // Title update
    document.getElementById("alertTitle").innerHTML =
      `Alert: <strong style="color: ${color};">${match.RuleID}</strong>`;
    
    const filePath = match.FilePath;

    // Add click event listener to the "Go to Line" button
    document.getElementById("goToLineButton").addEventListener("click", function () {
      // Assuming `FilePath` and `StartLine` are available from `match` object
      const filePath = match.FilePath; // Path to the file
      const lineNumber = match.StartLine; // Line number of the alert

      if (filePath && lineNumber) {
        // Send a message to the VS Code extension to open the file at the specified line
        vscode.postMessage({
          command: 'goToLine',
          filePath: filePath,
          lineNumber: lineNumber
        });
      }
    });
  }
  </script>

</body>
</html>
